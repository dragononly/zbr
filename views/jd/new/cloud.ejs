<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="https://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/popper.js/1.12.5/umd/popper.min.js"></script>
<script src="https://apps.bdimg.com/libs/jquerymobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
 <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <script src="https://cdn.bootcss.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
  
 <link href="../../images/ico.ico" rel="icon" type="image/x-icon" />
</head>





<body>

<div data-role="page" data-theme="a" class="ui-shadow">
	
<script type="text/javascript">
	
document.addEventListener('plusready', function() {
    var webview = plus.webview.currentWebview();
    plus.key.addEventListener('backbutton', function() {
    	
        webview.canBack(function(e) {
            if(e.canBack) {
                webview.back();
            } else {
                webview.close(); //hide,quit
                //plus.runtime.quit();
            }
        })
        
    });
});
</script>

	
	<style type="text/css">
		.fileView>li>a>img{
			height: 99% ;
		}
	</style>
	
	
	
	<div data-role="panel" id="myPanel"> 
    <h2>é¢æ¿å¤´éƒ¨..</h2>
    <p>é¢æ¿å†…å®¹..</p>
  </div> 
	
	

	
	
  <div data-role="header" data-position="fixed" id="header">
    <!--<a href="#myPanel" class="ui-btn ui-icon-bars ui-btn-icon-left">ä¸ªäººä¸­å¿ƒ</a>
    <h1>æ¬¢è¿è®¿é—®ï¼Œäº‘ç›˜</h1>
    <a href="#" class="ui-btn ui-corner-all ui-shadow ui-icon-search ui-btn-icon-left">æœç´¢</a>-->
  </div>

   <div data-role="main" class="ui-content">
   	
   	
   	  <div id="course" style="display: none;">
   	  	<div>ç¬¬ä¸€æ­¥ï¼šç‚¹å‡»å›¾ç‰‡</div>
   	  	<div>ç¬¬äºŒæ­¥ï¼šå¤åˆ¶è¾“å…¥æ¡†ä¸­çš„æŒ‰é’®</div>
   	  	
   	  </div>
   	  
   	  <script type="text/javascript">
   	  	function show_course () {
   	  		$('#course').show()
   	  	}
   	  </script>
   	
      <form method="post" action="demo_form.php">
			<div class="ui-field-contain" >
			<!--<input type="search" name="search" id="search" >-->
			<input type="text" id="show_img" placeholder="ç‚¹å‡»å›¾ç‰‡ï¼Œç„¶åå¤åˆ¶æˆ‘"/>
			 <a href="#" class="ui-btn ui-corner-all ui-shadow ui-icon-search ui-btn-icon-left" onclick="show_course()">ğŸ‘†ğŸ‘†ğŸ‘†é•¿æŒ‰å¤åˆ¶/å…ˆç‚¹å‡»</a>
			</div>
	  </form>
				<ul data-role="listview" class="fileView" >
				
				</ul>
   
   <div style="width: 50%;margin: auto;margin-top: 30px;border: 1px solid black;padding: 10px;display: none;position: fixed;z-index: 2;top:30%;background:#2f2f2f;left:0;right: 0;border-radius: 5px;" id='mkdirShow'>
		       
		      <label for="mkdirText" style="margin-top:5px;">æ–‡ä»¶åï¼š</label>
		      <input type="text" name="mkdirText" id="mkdirText">
		      <input type="button" data-inline="true" value="å–æ¶ˆ" id="mkdirHide">
		      <input type="button" data-inline="true" value="ç¡®å®š" id="mkdirSub">
		  
   </div>
   
   
   <div style="width: 50%;margin: auto;margin-top: 30px;border: 1px solid black;padding: 10px;display: none;position: fixed;z-index: 2;top:30%;background:#2f2f2f;left:0;right: 0;border-radius: 5px;" id='editShow'>
		       
		      <label for="editText" style="margin-top:5px;">æ–°çš„æ–‡ä»¶åï¼š</label>
		      <input type="text" name="editText" id="editText">
		      <input type="button" data-inline="true" value="å–æ¶ˆ" id="editHide">
		      <input type="button" data-inline="true" value="ç¡®å®š" id="editSub">
		  
   </div>
   
   <div style="width: 50%;margin: auto;margin-top: 30px;border: 1px solid black;padding: 10px;display: none;position: fixed;z-index: 2;top:30%;background:#2f2f2f;left:0;right: 0;border-radius: 5px;" id='moveFile'>
		       
		      <label for="moveText" style="margin-top:5px;">æ–°çš„æ–‡ä»¶åï¼š</label>
		      <input type="text" name="moveText" id="moveText" value="è¿˜æ²¡å†™ï¼Œå…ˆå¿å¿">
		      <input type="button" data-inline="true" value="å–æ¶ˆ" id="moveHide">
		      <input type="button" data-inline="true" value="ç¡®å®š" id="moveSub">
		  
   </div>
   
   
   
   
   
   
    <div class="uploadBox" style="width: 50%;margin: auto;margin-top: 30px;border: 1px solid black;padding: 10px;display: none;position: fixed;z-index: 3;top:30%;background:#2f2f2f;left:0;right: 0;border-radius: 5px;" id="uploadFile">
		
	       <div style="font-size: 12px;">
		    <progress id="progressBar" value="0" max="100" ></progress>
		    <span id="percentage"></span>
		    <span id="time"></span>
           </div>
		    <input type="file" id="file" name="myfile" multiple="multiple"/>
		    <input type="button" value="ä¸Šä¼ " id="start"/>
		    <!--<input type="button"  value="éšè—çª—å£" class="clearo"/>-->

		    <input type="button"  value="å–æ¶ˆ" id="cancel"/>
	     <script type="text/javascript">
	     	$('#cancel').click(e=>{$('#uploadFile').hide()})
	     </script>
	     </div>

   
   </div>
   

   <div data-role="footer" data-position="fixed">
   	
	<div data-role="navbar" class="foo1">
      <ul>
        
        <li><a href="#myPop1" data-rel="popup" data-icon="plus" id="newFlie">æ–°å»º</a></li>
        <li><a href="#" data-icon="cloud" id="uploadButton">ä¸Šä¼ </a></li>
		<li id="goback"><a href="#myPop1" data-rel="popup" data-icon="carat-u" >è¿”å›æœ€åˆ</a></li>
		
		
      </ul>
    </div>
    <script>
			$(function(){
				$('#goback').on('click',function () {
					location.href='cloud'
				})
			})
    </script>
    <div data-role="navbar"class="foo2" style="display: none;" >
      <ul>
        <li><a href="#" data-icon="arrow-d" id="downloadFile">ä¸‹è½½</a></li>
        <li><a href="#" data-icon="delete" id="delete">åˆ é™¤</a></li>
        <li ><a href="#myPop1" data-rel="popup" data-icon="edit" id="edit">é‡å‘½å</a></li>
        <li ><a href="#" data-rel="popup" data-icon="arrow-r" id="move">ç§»åŠ¨åˆ°</a></li>
      </ul>
    </div>
    </div>
  
  
<script type="text/javascript">
$(function  () {
	let data='<%- user%>',data_all;
     	$('.fileView').empty()	
	
	fetch('/cloud/get?order=getFile&data='+data, {
		 method: 'GET',
		})
		.then((res)=>{
		return res.json() 
		})
		.then((res)=>{
			data_all=res
        		   
        })
		.then((res)=>{
			 //å…³äºä»æ•°æ®è¯»å–æ–‡ä»¶åï¼ŒåŠ è½½æ–‡ä»¶
      

       	for (let i of data_all){
       			if(i.lastIndexOf('.')==-1){
			
			$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/file.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
			
	       	}else if(i.indexOf('.txt')!=-1){
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/txt.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}else if(i.indexOf('.exe')!=-1){
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/exe.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}else if(i.indexOf('.pdf')!=-1){
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/pdf.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}else if(i.indexOf('.word')!=-1){
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/word.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}else if(i.indexOf('.xls')!=-1){
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/xls.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}else if(i.indexOf('.zip')!=-1 || i.indexOf('.rar')!=-1){
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/zip.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}else{
	       		
	       		$('.fileView').append('<li class="ui-li-has-alt ui-li-has-thumb">' + '<a class="ui-btn"><img src="../images/cloud/cloud.png" alt="" /><h1>'+i+'</h1><p></p></a>' +'<a class="ui-btn ui-btn-icon-notext ui-icon-carat-r ui-icon-check ui-btn-icon-left ui-alt-icon">'+'</a>'+'</li>')
	       		
	       	}
       		
       		
       	}//for end!!!!!!!

    	//æ–‡ä»¶ï¼Œé€‰æ‹©é€»è¾‘
    	//é€»è¾‘1ï¼Œé€‰æ‹©åæ”¹å˜å‹¾é€‰çŠ¶æ€
    	$('.fileView>li>a:nth-child(2)').on('click',function  () {
    		
    		
    		$(this).toggleClass("ui-alt-icon");
    		$(this).toggleClass("me");
    	
    		
    		if($('.fileView>li>a:nth-child(2)').hasClass('me')){
    			
    			$('.foo2').show() 
    			$('.foo1').hide()
    		
    		}else{
    			$('.foo2').hide()
    			$('.foo1').show()
    		}
    		
    		
    	})
	
    	
     
       	
       	
       	
       	$('.fileView>li>a:nth-child(1)').tap(function  () {
       		
       		let temp=$(this).find('h1').html()
       		
       		if(temp.lastIndexOf('.')==-1){
       			location.href=encodeURI("jumpFile?user="+'<%- user%>/'+temp)
       		}else{
       			let url='../cloud/'+'<%- user%>'+'/'+temp
       			//location.href=url
       			url=encodeURI(url)
       			$('#show_img').val(url)
       		}

       	})
	
	})
	.then((res)=>{

      $('#mkdirSub').tap(e=>{
        		
        let data=[]
        data[0]='<%- user%>'
        data[1]=$('#mkdirText').val()
   
        fetch('/cloud/get?order=newFile&data='+data, {
		 method: 'GET',
		})
		.then((res)=>{
		return res.json() 
		})	
        .then((res)=>{
        	
             if(res==true){
        		window.location.reload()
        				}
             
		})		
		
       })
        	
        
	
	})
	
	
	editFile ()
	downloadFile()
	deFile()
	
})//end!

	







	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	




        function editFile () {
        	
        	$('#editSub').bind('click',e=>{
        		let data=[]
        		data[0]='<%- user%>'
        		data[1]=$($('.me')[0]).prev().find('h1').html()
        		let index=data[1].lastIndexOf('.')
        		if(index!=-1){
        			let last=data[1].substr(index)        		
        		    data[2]=$('#editText').val()+last
        		}else{
        			 data[2]=$('#editText').val()
        		}
        		
        		
        		
        		
        fetch('/cloud/get?order=editFile&data='+data, {
		 method: 'GET',
		})
		.then((res)=>{
		return res.json() 
		})
		.then((res)=>{
			
			location.reload()
        		   
        })

        		
        		
        	})
        	
        }
        
        
        
        
        
    
    
      function downloadFile () {
      	
      	$('#downloadFile').click(e=>{
      
      		  let arry=[]
        
          for (let i = 0; i < $('.me').length; i++) {
        	
        	arry[i]=$($('.me')[i]).prev().find('h1').html()
        	
        }
        	
        	let data={}
        	    data.user='<%- user%>'
                data.arry=arry
        	
      		 $('#header').append('<a class="down" download="" href="" data-ajax="false" style="display: none;" ></>')
					      var i=0;
		
		        for(let i of data.arry){
		        	var want='<%- user%>/'+i;
					      	      
					      	  $('.down').attr('href',want)
					      	  
							  $('.down')[0].click()
		        }

      	})
      	
      	
      	
      }
    
    
    
    
    
    
    
        function deFile () {

        	$('#delete').tap(e=>{
        		
        	  let data=[]
	        	  data[0]='<%- user%>'
	              data[1]=[]

        
          for (let i = 0; i < $('.me').length; i++) {
        	
        	data[1][i]=$($('.me')[i]).prev().find('h1').html()
        	
        }
           data = JSON.stringify(data);
        fetch("/cloud/get?&order=deFile&data="+data, {
		    method: 'GET',
		    headers: new Headers({
		      'Accept': 'application/json' 
		    })
		  })
		  .then((res)=>{
		    return res.json() 
		  })
		  .then((res)=>{
		    if(res==true){
		    	window.location.reload()
		    }
		  })

  	   })
        	
        	
        }




       
       
       upload()
       
       
       
       function upload () {
    		
    	
    	
        var xhr;
        var ot;//
        var oloaded;
        //ä¸Šä¼ æ–‡ä»¶æ–¹æ³•
        
        $('#start').on("tap",function  () {
        	start()
        })
        
        var dataLength=0;
        
        function start() {
        
  
            var url = "/upload"; // æ¥æ”¶ä¸Šä¼ æ–‡ä»¶çš„åå°åœ°å€ 
            var form = new FormData(); // FormData å¯¹è±¡
            form.enctype="multipart/form-data";
           
        	
        		  var fileObj = document.getElementById("file").files
        		
        		
        		   for (var i = 0; i <fileObj.length; i++) {
        		   	
        		   	form.append("mf", fileObj[i]); // æ–‡ä»¶å¯¹è±¡
                    dataLength=dataLength+parseInt(fileObj[i].size);
        		   	
        		   }

            form.append("address",'<%- user%>' ); // æ–‡ä»¶å¯¹è±¡
            
            xhr = new XMLHttpRequest();  // XMLHttpRequest å¯¹è±¡
            xhr.open("post", url, true); //postæ–¹å¼ï¼Œurlä¸ºæœåŠ¡å™¨è¯·æ±‚åœ°å€ï¼Œtrue è¯¥å‚æ•°è§„å®šè¯·æ±‚æ˜¯å¦å¼‚æ­¥å¤„ç†ã€‚
            xhr.onload = uploadComplete; //è¯·æ±‚å®Œæˆ
            xhr.onerror =  uploadFailed; //è¯·æ±‚å¤±è´¥
            xhr.upload.onprogress = progressFunction;//ã€ä¸Šä¼ è¿›åº¦è°ƒç”¨æ–¹æ³•å®ç°ã€‘
            xhr.upload.onloadstart = function(){//ä¸Šä¼ å¼€å§‹æ‰§è¡Œæ–¹æ³•
                ot = new Date().getTime();   //è®¾ç½®ä¸Šä¼ å¼€å§‹æ—¶é—´
                oloaded = 0;//è®¾ç½®ä¸Šä¼ å¼€å§‹æ—¶ï¼Œä»¥ä¸Šä¼ çš„æ–‡ä»¶å¤§å°ä¸º0
            };
            xhr.send(form); //å¼€å§‹ä¸Šä¼ ï¼Œå‘é€formæ•°æ®
        }
        //ä¸Šä¼ è¿›åº¦å®ç°æ–¹æ³•ï¼Œä¸Šä¼ è¿‡ç¨‹ä¸­ä¼šé¢‘ç¹è°ƒç”¨è¯¥æ–¹æ³•
        function progressFunction(evt) {
            
             var progressBar = document.getElementById("progressBar");
             var percentageDiv = document.getElementById("percentage");
             // event.totalæ˜¯éœ€è¦ä¼ è¾“çš„æ€»å­—èŠ‚ï¼Œevent.loadedæ˜¯å·²ç»ä¼ è¾“çš„å­—èŠ‚ã€‚å¦‚æœevent.lengthComputableä¸ä¸ºçœŸï¼Œåˆ™event.totalç­‰äº0
             if (evt.lengthComputable) {//
                 progressBar.max = evt.total;
                 progressBar.value = evt.loaded;
                 percentageDiv.innerHTML = Math.round(evt.loaded / evt.total * 100) + "%";
             }
            
            var time = document.getElementById("time");
            var nt = new Date().getTime();//è·å–å½“å‰æ—¶é—´
            var pertime = (nt-ot)/1000; //è®¡ç®—å‡ºä¸Šæ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶åˆ°ç°åœ¨çš„æ—¶é—´å·®ï¼Œå•ä½ä¸ºs
            ot = new Date().getTime(); //é‡æ–°èµ‹å€¼æ—¶é—´ï¼Œç”¨äºä¸‹æ¬¡è®¡ç®—
            
            var perload = evt.loaded - oloaded; //è®¡ç®—è¯¥åˆ†æ®µä¸Šä¼ çš„æ–‡ä»¶å¤§å°ï¼Œå•ä½b       
            oloaded = evt.loaded;//é‡æ–°èµ‹å€¼å·²ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼Œç”¨ä»¥ä¸‹æ¬¡è®¡ç®—
        
            //ä¸Šä¼ é€Ÿåº¦è®¡ç®—
            var speed = perload/pertime;//å•ä½b/s
            var bspeed = speed;
            var units = 'b/s';//å•ä½åç§°
            if(speed/1024>1){
                speed = speed/1024;
                units = 'k/s';
            }
            if(speed/1024>1){
                speed = speed/1024;
                units = 'M/s';
            }
            speed = speed.toFixed(1);
            //å‰©ä½™æ—¶é—´
            var resttime = ((evt.total-evt.loaded)/bspeed).toFixed(1);
            time.innerHTML = 'ï¼Œé€Ÿåº¦ï¼š'+speed+units+'ï¼Œå‰©ä½™æ—¶é—´ï¼š'+resttime+'s';
               if(bspeed==0)
                time.innerHTML = 'ä¸Šä¼ å·²å–æ¶ˆ';
        }
        //ä¸Šä¼ æˆåŠŸå“åº”
        function uploadComplete(evt) {

                     alert("ä¸Šä¼ æˆåŠŸï¼");
                      window.location.reload()
       
    }
        //ä¸Šä¼ å¤±è´¥
        function uploadFailed(evt) {
            alert("ä¸Šä¼ å¤±è´¥ï¼");
        }
         

         //å–æ¶ˆä¸Šä¼ 
        $('.clear').on("tap",function  () {
        	 xhr.abort();
        })
        
       }
       
       
       
       
       
       
       



	
        css()

    	function css () {
    		
    		$('.fileView>li>a:nth-child(2)').addClass("ui-btn ui-icon-check ui-btn-icon-left")
    		
    		$('#newFlie').click(e=>{
    			$('#mkdirShow').show()
    		})
    		
    		
    		$('#mkdirHide').click(e=>{
    			$('#mkdirShow').hide()
    		})
    		
    		
    		$('#uploadButton').click(e=>{
    			$('#uploadFile').show()
    		})
    		
    		
    		$('#uploadButton').click(e=>{
    			$('#uploadFile').show()
    		})
    		
    		$('#edit').click(e=>{
    			$('#editShow').show()
    		})
    		$('#editHide').click(e=>{$('#editShow').hide()})
    		
    		
    		$('#move').click(e=>{$('#moveFile').show()})
    		$('#moveHide').click(e=>{$('#moveFile').hide()})
             
    	}
    	
    	
    	
    	
    	

    	
    	
    	
    	
    </script>
  
  
  
  
  
  
  
  
  
  
  
  
</div>

</html>
</body>
